<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - YGWIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #fff;
      padding: 20px;
    }
    h2 {
      border-bottom: 2px solid #6a0dad;
      padding-bottom: 5px;
    }
    .card {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 25px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
    }
    input, select, button {
      padding: 10px;
      margin: 6px 0;
      width: 100%;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }
    button { background: #6a0dad; color: white; cursor: pointer; }
    .btn-danger { background: #e53935; }
    .btn-success { background: #43a047; }
    .flex { display: flex; gap: 10px; }
    .flex-column { flex-direction: column; }
    .flex-row { flex-direction: row; flex-wrap: wrap; }
    .request-box { background: #2a2a2a; padding: 10px; margin: 10px 0; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>YGWIN Admin Panel</h1>  <div class="card">
    <h2>Set Result (Current Period: <span id="currentPeriod"></span>)</h2>
    <select id="manualResult">
      <option value="">-- Select Result --</option>
      <option value="RED">RED</option>
      <option value="GREEN">GREEN</option>
    </select>
    <button onclick="setResult()">Set Result</button>
  </div>  <div class="card">
    <h2>Update Deposit QR (Upload Image)</h2>
    <input type="file" id="qrUpload" accept="image/*">
    <button onclick="uploadQRImage()">Upload & Set QR</button>
  </div>  <div class="card">
    <h2>Pending Deposit Requests</h2>
    <div id="depositList"></div>
  </div>  <div class="card">
    <h2>Pending Withdrawal Requests</h2>
    <div id="withdrawList"></div>
  </div>  <div class="card">
    <h2>Total Bet Summary (Current Period)</h2>
    <p id="betSummary">RED: ₹0 | GREEN: ₹0</p>
  </div><script>
function getPeriod(offset = 0) {
  const now = new Date();
  const mins = now.getUTCHours() * 60 + now.getUTCMinutes() + offset;
  return now.getUTCFullYear().toString() +
    String(now.getUTCMonth() + 1).padStart(2, '0') +
    String(now.getUTCDate()).padStart(2, '0') + "1000" + (10001 + mins);
}

function loadCurrentPeriod() {
  const period = getPeriod();
  document.getElementById("currentPeriod").innerText = period;
  return period;
}

function setResult() {
  const period = getPeriod(-1); // Previous period
  const result = document.getElementById("manualResult").value;
  if (!result) return alert("Select a result");
  const all = JSON.parse(localStorage.getItem("manualResults") || '{}');
  all[period] = result;
  localStorage.setItem("manualResults", JSON.stringify(all));
  alert("Result for period " + period + " set to " + result);
}

function uploadQRImage() {
  const file = document.getElementById("qrUpload").files[0];
  if (!file) return alert("Please select a file");
  const reader = new FileReader();
  reader.onload = function (e) {
    localStorage.setItem("qrImg", e.target.result);
    alert("QR Image updated successfully");
  };
  reader.readAsDataURL(file);
}

function loadDeposits() {
  const list = JSON.parse(localStorage.getItem("depositRequests") || '[]');
  const div = document.getElementById("depositList");
  div.innerHTML = "";
  const users = JSON.parse(localStorage.getItem("users") || '{}');
  list.forEach((r, i) => {
    const box = document.createElement("div");
    box.className = "request-box";
    box.innerHTML = `User: ${r.user}<br>Amount: ₹${r.amt}<br>UTR: ${r.utr}<br>
      <div class='flex'>
        <button class='btn-success' onclick='approveDeposit(${i})'>Approve</button>
        <button class='btn-danger' onclick='rejectDeposit(${i})'>Reject</button>
      </div>`;
    div.appendChild(box);
  });
}

function approveDeposit(index) {
  const list = JSON.parse(localStorage.getItem("depositRequests") || '[]');
  const users = JSON.parse(localStorage.getItem("users") || '{}');
  const req = list[index];
  users[req.user].balance += req.amt;
  list.splice(index, 1);
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("depositRequests", JSON.stringify(list));
  loadDeposits();
  alert("Deposit Approved");
}

function rejectDeposit(index) {
  const list = JSON.parse(localStorage.getItem("depositRequests") || '[]');
  list.splice(index, 1);
  localStorage.setItem("depositRequests", JSON.stringify(list));
  loadDeposits();
  alert("Deposit Rejected");
}

function loadWithdrawals() {
  const list = JSON.parse(localStorage.getItem("withdrawRequests") || '[]');
  const div = document.getElementById("withdrawList");
  div.innerHTML = "";
  list.forEach((r, i) => {
    const box = document.createElement("div");
    box.className = "request-box";
    box.innerHTML = `User: ${r.user}<br>Amount: ₹${r.amt}<br>UPI: ${r.upi}<br>
      <div class='flex'>
        <button class='btn-success' onclick='approveWithdraw(${i})'>Approve</button>
        <button class='btn-danger' onclick='rejectWithdraw(${i})'>Reject</button>
      </div>`;
    div.appendChild(box);
  });
}

function approveWithdraw(index) {
  const list = JSON.parse(localStorage.getItem("withdrawRequests") || '[]');
  const users = JSON.parse(localStorage.getItem("users") || '{}');
  const req = list[index];
  users[req.user].balance -= req.amt;
  list.splice(index, 1);
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("withdrawRequests", JSON.stringify(list));
  loadWithdrawals();
  alert("Withdrawal Approved");
}

function rejectWithdraw(index) {
  const list = JSON.parse(localStorage.getItem("withdrawRequests") || '[]');
  list.splice(index, 1);
  localStorage.setItem("withdrawRequests", JSON.stringify(list));
  loadWithdrawals();
  alert("Withdrawal Rejected");
}

function showBetSummary() {
  const bets = JSON.parse(localStorage.getItem("userBets") || '{}');
  const period = getPeriod();
  let red = 0, green = 0;
  for (let k in bets) {
    if (k.startsWith(period)) {
      if (bets[k].color === 'RED') red += bets[k].amt;
      else if (bets[k].color === 'GREEN') green += bets[k].amt;
    }
  }
  document.getElementById("betSummary").innerText = `RED: ₹${red} | GREEN: ₹${green}`;
}

// INIT
loadCurrentPeriod();
loadDeposits();
loadWithdrawals();
showBetSummary();
setInterval(() => {
  loadCurrentPeriod();
  showBetSummary();
}, 5000);
</script></body>
  </html>
