<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel - YGWIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial; background: #121212; color: #fff; margin: 0; padding: 0; }
    .header { background: #1f1f1f; padding: 15px; text-align: center; font-size: 20px; font-weight: bold; }
    .section { padding: 15px; }
    .box {
      background: #1e1e1e; padding: 15px; margin-bottom: 15px;
      border-radius: 8px; box-shadow: 0 0 10px #00000055;
    }
    button {
      padding: 8px 12px; margin: 5px;
      border: none; border-radius: 5px; cursor: pointer;
    }
    .approve { background: green; color: #fff; }
    .reject { background: red; color: #fff; }
    .input { background: #2c2c2c; color: white; border: none; padding: 8px; width: 100%; margin-top: 5px; border-radius: 5px; }
  </style>
</head>
<body>

<div class="header">Admin Panel - YGWIN</div>

<div class="section">
  <div class="box">
    <h3>Set Result</h3>
    <p id="periodText">Period: loading...</p>
    <select id="resultSelect" class="input">
      <option value="">Select Result</option>
      <option value="RED">RED</option>
      <option value="GREEN">GREEN</option>
    </select>
    <button onclick="setResult()">Submit Result</button>
  </div>

  <div class="box">
    <h3>Approve/Reject Deposits</h3>
    <div id="depositRequests">Loading...</div>
  </div>

  <div class="box">
    <h3>Approve/Reject Withdrawals</h3>
    <div id="withdrawRequests">Loading...</div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
  import { getDatabase, ref, onValue, remove, set, update } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

  // Your Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCZFXeJZxc8CJiDz-KBLNKu6JW85LVgYjs",
    authDomain: "yash-first-64655.firebaseapp.com",
    databaseURL: "https://yash-first-64655-default-rtdb.firebaseio.com",
    projectId: "yash-first-64655",
    storageBucket: "yash-first-64655.appspot.com",
    messagingSenderId: "610242949077",
    appId: "1:610242949077:web:216a0905cf9850969f175c"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Auto Period Generator
  function getCurrentPeriod() {
    const now = new Date();
    const minutes = now.getUTCHours() * 60 + now.getUTCMinutes();
    const date = now.toISOString().slice(0,10).replace(/-/g,"");
    return `${date}1000${10001 + minutes}`;
  }
  document.getElementById("periodText").innerText = "Period: " + getCurrentPeriod();

  // Set Result
  function setResult() {
    const result = document.getElementById("resultSelect").value;
    if (result) {
      const period = getCurrentPeriod();
      set(ref(db, "results/" + period), result);
      alert("Result set to " + result);
    }
  }

  // Load Deposit Requests
  const depositDiv = document.getElementById("depositRequests");
  onValue(ref(db, "depositRequests"), snapshot => {
    depositDiv.innerHTML = "";
    if (!snapshot.exists()) {
      depositDiv.innerText = "No deposit requests.";
      return;
    }
    snapshot.forEach(child => {
      const data = child.val();
      const html = `
        <div class="box">
          <p><b>Phone:</b> ${data.phone}</p>
          <p><b>Amount:</b> ₹${data.amount}</p>
          <p><b>UTR:</b> ${data.utr}</p>
          <button class="approve" onclick="approveDeposit('${child.key}', '${data.phone}', ${data.amount})">Approve</button>
          <button class="reject" onclick="rejectDeposit('${child.key}', '${data.phone}', ${data.amount})">Reject</button>
        </div>
      `;
      depositDiv.innerHTML += html;
    });
  });

  // Approve Deposit
  window.approveDeposit = (key, phone, amount) => {
    remove(ref(db, "depositRequests/" + key));
    alert("Approved. Add ₹" + amount + " manually to UPI.");
  };

  // Reject Deposit
  window.rejectDeposit = (key, phone, amount) => {
    remove(ref(db, "depositRequests/" + key));
    const walletRef = ref(db, "users/" + phone + "/balance");
    onValue(walletRef, snapshot => {
      let current = snapshot.val() || 0;
      update(ref(db, "users/" + phone), { balance: current + amount });
    }, { onlyOnce: true });
    alert("Deposit rejected & refunded.");
  };

  // Withdraw Requests
  const withdrawDiv = document.getElementById("withdrawRequests");
  onValue(ref(db, "withdrawRequests"), snapshot => {
    withdrawDiv.innerHTML = "";
    if (!snapshot.exists()) {
      withdrawDiv.innerText = "No withdrawal requests.";
      return;
    }
    snapshot.forEach(child => {
      const data = child.val();
      const html = `
        <div class="box">
          <p><b>Phone:</b> ${data.phone}</p>
          <p><b>Amount:</b> ₹${data.amount}</p>
          <p><b>UPI:</b> ${data.upi}</p>
          <button class="approve" onclick="approveWithdraw('${child.key}')">Approve</button>
          <button class="reject" onclick="rejectWithdraw('${child.key}', '${data.phone}', ${data.amount})">Reject</button>
        </div>
      `;
      withdrawDiv.innerHTML += html;
    });
  });

  // Approve Withdraw
  window.approveWithdraw = (key) => {
    remove(ref(db, "withdrawRequests/" + key));
    alert("Withdraw Approved. Please send money manually.");
  };

  // Reject Withdraw
  window.rejectWithdraw = (key, phone, amount) => {
    remove(ref(db, "withdrawRequests/" + key));
    const walletRef = ref(db, "users/" + phone + "/balance");
    onValue(walletRef, snapshot => {
      let current = snapshot.val() || 0;
      update(ref(db, "users/" + phone), { balance: current + amount });
    }, { onlyOnce: true });
    alert("Withdraw rejected & amount returned.");
  };
</script>

</body>
                                   </html>
