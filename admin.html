<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YGWIN Game (Backend)</title>
  <style>
    body {
      background: #121212;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .card {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: none;
      border-radius: 5px;
    }
    button { background: #6a0dad; color: white; font-weight: bold; }
    .red { background: #e53935; }
    .green { background: #43a047; }
    #history div { margin: 5px 0; font-size: 14px; }
  </style>
</head>
<body>
<div id="auth" class="card">
  <h2>Login or Register</h2>
  <input type="text" id="phone" placeholder="Enter Phone Number">
  <input type="password" id="password" placeholder="Enter Password">
  <button onclick="login()">Login</button>
  <button onclick="register()">Register</button>
</div><div id="game" class="card" style="display:none;">
  <h2>Wingo 1 Minute Game</h2>
  <p id="period"></p>
  <p id="timer"></p>
  <p>Wallet: â‚¹<span id="wallet">0</span></p>
  <input id="betAmt" placeholder="Enter Bet Amount">
  <button class="red" onclick="placeBet('RED')">Bet RED</button>
  <button class="green" onclick="placeBet('GREEN')">Bet GREEN</button>
  <p id="result"></p>
  <h3>History</h3>
  <div id="history"></div>
  <button onclick="logout()">Logout</button>
</div><script>
let token = localStorage.getItem("token");
if(token) showGame();

function register() {
  fetch('api/register.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ phone: phone.value, password: password.value })
  }).then(r => r.json()).then(data => {
    if(data.success) { localStorage.setItem("token", data.token); showGame(); }
    else alert(data.message);
  });
}

function login() {
  fetch('api/login.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ phone: phone.value, password: password.value })
  }).then(r => r.json()).then(data => {
    if(data.success) { localStorage.setItem("token", data.token); showGame(); }
    else alert(data.message);
  });
}

function logout() {
  localStorage.removeItem("token");
  location.reload();
}

function showGame() {
  document.getElementById("auth").style.display = 'none';
  document.getElementById("game").style.display = 'block';
  fetchWallet();
  setInterval(updateGame, 1000);
}

function fetchWallet() {
  fetch('api/wallet.php', {
    headers: { 'Authorization': localStorage.getItem("token") }
  }).then(r => r.json()).then(data => {
    if(data.success) document.getElementById("wallet").innerText = data.balance;
  });
}

function getPeriod(minuteOffset = 0) {
  const now = new Date();
  const mins = now.getUTCHours() * 60 + now.getUTCMinutes() + minuteOffset;
  return now.getUTCFullYear().toString() +
         String(now.getUTCMonth() + 1).padStart(2, '0') +
         String(now.getUTCDate()).padStart(2, '0') +
         "1000" + (10001 + mins);
}

function updateGame() {
  const now = new Date();
  const sec = now.getUTCSeconds();
  const rem = 60 - sec;
  const currentPeriod = getPeriod();

  document.getElementById("period").innerText = "Period: " + currentPeriod;
  document.getElementById("timer").innerText = "Timer: 00:" + String(rem).padStart(2, '0');

  if(sec === 0) {
    fetch('api/result.php?period=' + getPeriod(-1)).then(r => r.json()).then(data => {
      document.getElementById("result").innerText = "Result: " + data.result;
      fetchWallet();
      fetchHistory();
    });
  }
}

function placeBet(color) {
  const amt = parseFloat(document.getElementById("betAmt").value);
  if(!amt || amt <= 0) return alert("Enter valid amount");

  fetch('api/bet.php', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': localStorage.getItem("token")
    },
    body: JSON.stringify({ color: color, amount: amt, period: getPeriod() })
  }).then(r => r.json()).then(data => {
    alert(data.message);
    fetchWallet();
  });
}

function fetchHistory() {
  fetch('api/history.php', {
    headers: { 'Authorization': localStorage.getItem("token") }
  }).then(r => r.json()).then(data => {
    const container = document.getElementById("history");
    container.innerHTML = '';
    data.slice(0, 20).forEach(h => {
      const div = document.createElement('div');
      div.innerText = h.period + ' = ' + h.result;
      container.appendChild(div);
    });
  });
}
</script></body>
                   </html>
