<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #121212;
      color: white;
      padding: 20px;
    }
    .section {
      margin-bottom: 30px;
      padding: 15px;
      border: 1px solid #333;
      border-radius: 10px;
      background: #1e1e1e;
    }
    input, button {
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      border-radius: 8px;
      border: none;
    }
    button {
      background: #6a0dad;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<h2>Admin Login</h2>
<div id="loginSection" class="section">
  <input type="text" id="adminNumber" placeholder="Enter Admin Number">
  <input type="password" id="adminPass" placeholder="Enter Password">
  <button onclick="loginAdmin()">Login</button>
</div>

<div id="panelSection" style="display:none">
  <h2>ðŸŽ® Dashboard - Admin Panel</h2>

  <div class="section">
    <h3>ðŸ•“ Current Period</h3>
    <div id="periodDisplay">Loading...</div>
  </div>

  <div class="section">
    <h3>ðŸŽ¯ Set Game Result</h3>
    <select id="resultSelect">
      <option value="RED">RED</option>
      <option value="GREEN">GREEN</option>
    </select>
    <button onclick="setResult()">Set Result</button>
  </div>

  <div class="section">
    <h3>ðŸ§¾ Live Bets</h3>
    <div id="betSummary">Loading bet summary...</div>
  </div>

  <div class="section">
    <h3>ðŸ“¤ Deposit Requests</h3>
    <div id="depositList">Loading...</div>
  </div>

  <div class="section">
    <h3>ðŸ“¥ Withdrawal Requests</h3>
    <div id="withdrawList">Loading...</div>
  </div>

  <div class="section">
    <h3>ðŸ–¼ Update QR</h3>
    <input type="file" id="qrInput" accept="image/*">
    <button onclick="uploadQR()">Upload QR</button>
    <div id="qrStatus"></div>
  </div>

  <div class="section">
    <h3>ðŸ‘¥ All Users</h3>
    <div id="userList">Loading...</div>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCZFXeJZxc8CJiDz-KBLNKu6JW85LVgYjs",
    authDomain: "yash-first-64655.firebaseapp.com",
    databaseURL: "https://yash-first-64655-default-rtdb.firebaseio.com",
    projectId: "yash-first-64655",
    storageBucket: "yash-first-64655.appspot.com",
    messagingSenderId: "610242949077",
    appId: "1:610242949077:web:216a0905cf9850969f175c"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function loginAdmin() {
    const num = document.getElementById("adminNumber").value;
    const pass = document.getElementById("adminPass").value;
    if (num === "9770528555" && pass === "myselfyg26") {
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("panelSection").style.display = "block";
      loadAll();
    } else {
      alert("Invalid Admin ID or Password");
    }
  }

  function getCurrentPeriod() {
    const now = new Date();
    const mins = now.getUTCHours() * 60 + now.getUTCMinutes();
    return now.getUTCFullYear().toString() +
      String(now.getUTCMonth() + 1).padStart(2, '0') +
      String(now.getUTCDate()).padStart(2, '0') + "1000" + (10001 + mins);
  }

  function loadAll() {
    const period = getCurrentPeriod();
    document.getElementById("periodDisplay").innerText = period;

    // Load live bet summary
    db.ref("bets").once("value", (snap) => {
      let red = 0, green = 0;
      snap.forEach((child) => {
        const b = child.val();
        if (b.color === "RED") red += parseFloat(b.amount);
        if (b.color === "GREEN") green += parseFloat(b.amount);
      });
      document.getElementById("betSummary").innerText =
        `RED: â‚¹${red} | GREEN: â‚¹${green}`;
    });

    // Load deposit requests
    db.ref("depositRequests").on("value", (snap) => {
      let html = "";
      snap.forEach((child) => {
        const r = child.val();
        html += `
          <div>
            <b>${r.number}</b> â‚¹${r.amount} (UTR: ${r.utr})<br/>
            <button onclick="approveDeposit('${child.key}', ${r.amount}, '${r.number}')">Approve</button>
            <button onclick="rejectRequest('depositRequests','${child.key}')">Reject</button>
          </div><hr/>
        `;
      });
      document.getElementById("depositList").innerHTML = html || "No Requests";
    });

    // Load withdrawal requests
    db.ref("withdrawRequests").on("value", (snap) => {
      let html = "";
      snap.forEach((child) => {
        const r = child.val();
        html += `
          <div>
            <b>${r.number}</b> â‚¹${r.amount}<br/>UPI: ${r.upi}
            <button onclick="approveWithdraw('${child.key}', ${r.amount}, '${r.number}')">Approve</button>
            <button onclick="rejectRequest('withdrawRequests','${child.key}')">Reject</button>
          </div><hr/>
        `;
      });
      document.getElementById("withdrawList").innerHTML = html || "No Requests";
    });

    // Load all users
    db.ref("users").once("value", (snap) => {
      let html = "";
      snap.forEach((child) => {
        const u = child.val();
        html += `<div>ðŸ“± ${u.number} | ðŸ’° â‚¹${u.balance || 0} | ðŸ”‘ ${u.password}</div>`;
      });
      document.getElementById("userList").innerHTML = html || "No Users";
    });
  }

  function setResult() {
    const res = document.getElementById("resultSelect").value;
    const period = getCurrentPeriod();
    db.ref("results/" + period).set(res);
    alert("Result set for period " + period);
  }

  function approveDeposit(key, amt, number) {
    db.ref("users/" + number + "/balance").once("value", (snap) => {
      const current = snap.val() || 0;
      db.ref("users/" + number + "/balance").set(current + amt);
      db.ref("depositRequests/" + key).remove();
      alert("Deposit approved");
    });
  }

  function approveWithdraw(key, amt, number) {
    db.ref("users/" + number + "/balance").once("value", (snap) => {
      const current = snap.val() || 0;
      if (current >= amt) {
        db.ref("users/" + number + "/balance").set(current - amt);
        db.ref("withdrawRequests/" + key).remove();
        alert("Withdraw approved");
      } else {
        alert("Insufficient balance");
      }
    });
  }

  function rejectRequest(type, key) {
    db.ref(type + "/" + key).remove();
    alert("Request rejected");
  }

  function uploadQR() {
    const file = document.getElementById("qrInput").files[0];
    if (!file) return alert("Select QR image");
    const reader = new FileReader();
    reader.onload = () => {
      db.ref("qrImage").set(reader.result);
      document.getElementById("qrStatus").innerText = "QR Updated âœ…";
    };
    reader.readAsDataURL(file);
  }
</script>

</body>
    </html>
