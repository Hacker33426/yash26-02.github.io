<!DOCTYPE html><html>
<head>
  <title>Admin Panel - YGWIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #121212; color: #fff; font-family: sans-serif; padding: 20px; }
    .container { max-width: 600px; margin: auto; background: #1f1f1f; padding: 20px; border-radius: 12px; }
    h2 { text-align: center; }
    input, select, button {
      width: 100%; padding: 12px; margin-top: 10px;
      border: none; border-radius: 8px; font-size: 16px;
    }
    button {
      background: #6a0dad; color: white; font-weight: bold; cursor: pointer;
    }
    .entry {
      background: #292929; padding: 10px; margin-top: 10px; border-radius: 8px;
    }
    .entry button { width: 48%; margin-right: 2%; }
    .row { display: flex; gap: 8px; }
  </style>
</head>
<body>
  <div class="container">
    <h2>YGWIN Admin Panel</h2><div id="loginBox">
  <input id="adminNum" type="text" placeholder="Enter Admin Number">
  <input id="adminPass" type="password" placeholder="Enter Password">
  <button onclick="loginAdmin()">Login</button>
</div>

<div id="panelBox" style="display:none">
  <h3>Set Result</h3>
  <div id="currentPeriod">Period: loading...</div>
  <select id="setResult">
    <option value="RED">RED</option>
    <option value="GREEN">GREEN</option>
  </select>
  <button onclick="setManualResult()">Submit Result</button>

  <h3>Deposit Requests</h3>
  <div id="deposits">Loading...</div>

  <h3>Withdrawal Requests</h3>
  <div id="withdrawals">Loading...</div>
</div>

  </div><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script><script>
  const firebaseConfig = {
    apiKey: "AIzaSyCZFXeJZxc8CJiDz-KBLNKu6JW85LVgYjs",
    authDomain: "yash-first-64655.firebaseapp.com",
    databaseURL: "https://yash-first-64655-default-rtdb.firebaseio.com",
    projectId: "yash-first-64655",
    storageBucket: "yash-first-64655.appspot.com",
    messagingSenderId: "610242949077",
    appId: "1:610242949077:web:216a0905cf9850969f175c"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const ADMINS = {
    "9770528555": "myselfyg26"
  };

  function loginAdmin() {
    const num = document.getElementById("adminNum").value;
    const pass = document.getElementById("adminPass").value;
    if (ADMINS[num] === pass) {
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("panelBox").style.display = "block";
      loadPanel();
    } else {
      alert("Invalid Admin Credentials");
    }
  }

  function getCurrentPeriod() {
    const now = new Date();
    const mins = now.getUTCHours() * 60 + now.getUTCMinutes();
    return now.getUTCFullYear().toString() +
           String(now.getUTCMonth() + 1).padStart(2, '0') +
           String(now.getUTCDate()).padStart(2, '0') + "1000" + (10001 + mins);
  }

  function loadPanel() {
    document.getElementById("currentPeriod").innerText = "Period: " + getCurrentPeriod();
    db.ref("deposits").on('value', snap => {
      const d = snap.val();
      let html = '';
      for (let key in d) {
        html += `<div class='entry'>${key}: ₹${d[key].amount}<br><div class='row'>
          <button onclick="approveDeposit('${key}', ${d[key].amount})">Approve</button>
          <button onclick="rejectDeposit('${key}')">Reject</button></div></div>`;
      }
      document.getElementById("deposits").innerHTML = html || "No requests";
    });

    db.ref("withdrawals").on('value', snap => {
      const w = snap.val();
      let html = '';
      for (let key in w) {
        html += `<div class='entry'>${key}: ₹${w[key].amount}<br><div class='row'>
          <button onclick="approveWithdrawal('${key}', ${w[key].amount})">Approve</button>
          <button onclick="rejectWithdrawal('${key}')">Reject</button></div></div>`;
      }
      document.getElementById("withdrawals").innerHTML = html || "No requests";
    });
  }

  function setManualResult() {
    const result = document.getElementById("setResult").value;
    const period = getCurrentPeriod();
    db.ref("manualResults/" + period).set(result);
    alert("Result Set for Period: " + period);
  }

  function approveDeposit(user, amt) {
    db.ref("users/" + user + "/balance").once('value', snap => {
      const bal = snap.val() || 0;
      db.ref("users/" + user + "/balance").set(bal + amt);
      db.ref("deposits/" + user).remove();
    });
  }

  function rejectDeposit(user) {
    db.ref("deposits/" + user).remove();
  }

  function approveWithdrawal(user, amt) {
    db.ref("withdrawals/" + user).remove();
    alert("Send ₹" + amt + " to " + user + " via UPI manually");
  }

  function rejectWithdrawal(user) {
    db.ref("withdrawals/" + user).remove();
  }
</script></body>
  </html>
