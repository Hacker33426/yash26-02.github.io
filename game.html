<!DOCTYPE html>
<html>
<head>
  <title>YGWIN - Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
    }
    .box {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    button {
      width: 48%;
      padding: 12px;
      font-size: 16px;
      margin: 6px 1%;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    button.red { background: #e53935; color: white; }
    button.green { background: #43a047; color: white; }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
    }
    .qr { width: 100%; margin-top: 10px; border-radius: 10px; }
    .btn { background: #6a0dad; color: white; }
    .small { font-size: 14px; color: #ccc; }
  </style>
</head>
<body>

<div class="box">
  <h2>Wingo 1 Minute Game</h2>
  <div id="period">Period: </div>
  <div id="timer">Timer: </div>
  <div>Wallet Balance: ₹<span id="balance">0</span></div>
</div>

<div class="box">
  <h3>Enter Bet Amount</h3>
  <input type="number" id="amount" placeholder="e.g. 100">
  <button class="red" onclick="placeBet('RED')">Bet RED</button>
  <button class="green" onclick="placeBet('GREEN')">Bet GREEN</button>
</div>

<div class="box">
  <div id="result">Result: --</div>
  <h3>History</h3>
  <ul id="history"></ul>
</div>

<div class="box">
  <h3>Deposit</h3>
  <img id="qr" class="qr" src="" alt="Loading QR...">
  <div class="small">UPI ID: yashgolani26@fam</div>
  <input type="number" id="depositAmt" placeholder="Amount ₹">
  <input type="text" id="utr" placeholder="Enter 12-digit UTR">
  <button class="btn" onclick="submitDeposit()">Submit for Approval</button>
</div>

<div class="box">
  <h3>Withdraw</h3>
  <input type="number" id="withdrawAmt" placeholder="Amount ₹">
  <input type="text" id="upiId" placeholder="Your UPI ID">
  <button class="btn" onclick="submitWithdraw()">Request Withdrawal</button>
</div>

<div style="text-align:center;margin-top:20px;">
  <button class="btn" onclick="logout()">Logout</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCZFXeJZxc8CJiDz-KBLNKu6JW85LVgYjs",
    authDomain: "yash-first-64655.firebaseapp.com",
    databaseURL: "https://yash-first-64655-default-rtdb.firebaseio.com",
    projectId: "yash-first-64655",
    storageBucket: "yash-first-64655.appspot.com",
    messagingSenderId: "610242949077",
    appId: "1:610242949077:web:216a0905cf9850969f175c"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let user = localStorage.getItem("user");
  if (!user) window.location.href = "index.html";

  let balance = 0;
  let betData = JSON.parse(localStorage.getItem("bet")) || null;
  let manualResults = {};

  function getPeriod(offset = 0) {
    const now = new Date();
    const mins = now.getUTCHours() * 60 + now.getUTCMinutes() + offset;
    return now.getUTCFullYear().toString() +
      String(now.getUTCMonth()+1).padStart(2, '0') +
      String(now.getUTCDate()).padStart(2, '0') + "1000" + (10001 + mins);
  }

  function updatePeriodTimer() {
    const now = new Date();
    const sec = now.getUTCSeconds();
    const rem = 60 - sec;
    const currentPeriod = getPeriod();
    const lastPeriod = getPeriod(-1);

    document.getElementById("period").innerText = "Period: " + currentPeriod;
    document.getElementById("timer").innerText = "Timer: 00:" + String(rem).padStart(2, '0');

    if (sec === 0) {
      let result = manualResults[lastPeriod] || (Math.random() > 0.5 ? "RED" : "GREEN");
      document.getElementById("result").innerText = "Result: " + result;
      updateHistory(lastPeriod + " = " + result);

      if (betData && betData.period === lastPeriod) {
        if (betData.color === result) {
          let win = betData.amount + (betData.amount * 0.96);
          balance += win;
          alert("You WON ₹" + win.toFixed(2));
        } else {
          alert("You LOST ₹" + betData.amount);
        }
        betData = null;
        localStorage.removeItem("bet");
        db.ref("users/" + user + "/balance").set(balance);
      }
      document.getElementById("balance").innerText = balance.toFixed(2);
    }
  }

  function updateHistory(entry) {
    let list = JSON.parse(localStorage.getItem("history")) || [];
    list.unshift(entry);
    if (list.length > 10) list.pop();
    localStorage.setItem("history", JSON.stringify(list));
    showHistory();
  }

  function showHistory() {
    const list = JSON.parse(localStorage.getItem("history")) || [];
    document.getElementById("history").innerHTML = list.map(i => "<li>" + i + "</li>").join('');
  }

  function placeBet(color) {
    const amt = parseFloat(document.getElementById("amount").value);
    if (!amt || amt > balance || amt <= 0) return alert("Invalid amount");
    const period = getPeriod();
    betData = { color, amount: amt, period };
    balance -= amt;
    localStorage.setItem("bet", JSON.stringify(betData));
    db.ref("users/" + user + "/balance").set(balance);
    document.getElementById("balance").innerText = balance.toFixed(2);
    alert("Bet Placed on " + color);
  }

  function logout() {
    localStorage.removeItem("user");
    window.location.href = "index.html";
  }

  function submitDeposit() {
    const amt = document.getElementById("depositAmt").value;
    const utr = document.getElementById("utr").value;
    if (!amt || !utr || utr.length !== 12) return alert("Invalid details");
    db.ref("depositRequests").push({ user, amt, utr });
    alert("Deposit request sent for approval");
  }

  function submitWithdraw() {
    const amt = document.getElementById("withdrawAmt").value;
    const upi = document.getElementById("upiId").value;
    if (!amt || !upi) return alert("Fill details");
    db.ref("withdrawRequests").push({ user, amt, upi });
    alert("Withdrawal request sent");
  }

  setInterval(updatePeriodTimer, 1000);

  db.ref("users/" + user).on('value', snap => {
    if (snap.exists()) {
      balance = snap.val().balance || 0;
      document.getElementById("balance").innerText = balance.toFixed(2);
    }
  });

  db.ref("qr").on('value', snap => {
    if (snap.exists()) {
      document.getElementById("qr").src = snap.val();
    }
  });

  db.ref("manualResults").on('value', snap => {
    manualResults = snap.val() || {};
  });

  showHistory();
</script>
</body>
  </html>
