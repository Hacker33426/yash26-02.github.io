<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Color Prediction Game</title>
<style>
  body { font-family: Arial, sans-serif; background:#121212; color:#fff; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; }
  .box { background:#1e1e1e; border-radius:8px; padding:20px; margin:20px; width:320px; }
  input, button { width:100%; padding:10px; margin:8px 0; border:none; border-radius:4px; }
  input { background:#333; color:#fff; }
  button { background:#ff4455; color:#fff; cursor:pointer; font-weight:bold; }
  .bet-btn { width:48%; display:inline-block; margin:1%; }
  #timer { font-size:18px; margin:10px 0; }
</style>
</head>
<body>

<div id="auth" class="box">
  <h2 id="auth-title">Register</h2>
  <input type="text" id="mobile" placeholder="Mobile Number">
  <input type="password" id="pass" placeholder="Password">
  <input type="password" id="cpass" placeholder="Confirm Password">
  <button id="auth-btn">Register</button>
  <p id="switch"><a href="#">Already registered? Login</a></p>
</div>

<div id="game" class="box" style="display:none;">
  <h2>Wallet: ₹<span id="balance">0</span></h2>
  <button onclick="showDeposit()">Deposit (UTR)</button>
  <button onclick="showWithdraw()">Request Withdraw</button>
  <div id="deposit-box" style="display:none;">
    <input type="text" id="utr" placeholder="Enter 12-digit UTR">
    <button onclick="makeDeposit()">Submit UTR</button>
  </div>
  <div id="withdraw-box" style="display:none;">
    <input type="number" id="wamt" placeholder="Enter amount ≥50">
    <button onclick="makeWithdraw()">Request Withdraw</button>
  </div>
  <div id="timer">Next result in: <span id="time">60</span>s</div>
  <div>
    <button class="bet-btn" onclick="placeBet('Red')">Bet Red</button>
    <button class="bet-btn" onclick="placeBet('Green')">Bet Green</button>
    <button class="bet-btn" onclick="placeBet('Big')">Bet Big</button>
    <button class="bet-btn" onclick="placeBet('Small')">Bet Small</button>
  </div>
  <div id="bet-box" style="display:none;">
    <input type="number" id="bet-amt" placeholder="Enter bet amount ≥50">
    <button onclick="confirmBet()">Confirm Bet</button>
  </div>
  <div id="result"></div>
</div>

<script>
const minAmt = 50;
const STORAGE = 'cp_user';
const usersKey = 'cp_users';
let currentBet = null;

function getSaved() {
  const d = localStorage.getItem(STORAGE);
  if (!d) return null;
  const u = JSON.parse(d);
  if ((Date.now()-u.t)/(1000*60*60*24)>5) { localStorage.removeItem(STORAGE); return null; }
  return u;
}
function saveUser(mobile) {
  localStorage.setItem(STORAGE, JSON.stringify({ mobile, t: Date.now(), bal:50, dep:[], wdr:[] }));
}

function switchAuth(toReg) {
  document.getElementById('auth-title').innerText = toReg ? 'Register' : 'Login';
  document.getElementById('cpass').style.display = toReg ? 'block' : 'none';
  document.getElementById('auth-btn').innerText = toReg ? 'Register' : 'Login';
  document.getElementById('switch').innerHTML = toReg 
    ? '<a href="#">Already have account? Login</a>' 
    : '<a href="#">New? Register</a>';
  document.getElementById('switch').onclick = e => { e.preventDefault(); switchAuth(!toReg); };
}
switchAuth(true);

document.getElementById('auth-btn').onclick = () => {
  const mb = document.getElementById('mobile').value, pw = document.getElementById('pass').value;
  const cp = document.getElementById('cpass').value;
  let users = JSON.parse(localStorage.getItem(usersKey)||'[]');
  if (document.getElementById('cpass').style.display!='none') {
    if (!mb||!pw||pw!==cp) return alert('Invalid input or mismatch');
    if (users.find(u=>u.mobile===mb)) return alert('Number exists');
    users.push({mobile:mb,pw}); localStorage.setItem(usersKey, JSON.stringify(users));
    saveUser(mb);
  } else {
    const u = users.find(u=>u.mobile===mb&&u.pw===pw);
    if (!u) return alert('Invalid login');
    saveUser(mb);
  }
  initGame();
};

function initGame() {
  const u = getSaved(); if (!u) return;
  document.getElementById('auth').style.display='none';
  document.getElementById('game').style.display='block';
  document.getElementById('balance').innerText=u.bal;
  startTimer();
}
initGame();

function showDeposit(){
  toggleBoxes('deposit');
}
function showWithdraw(){
  toggleBoxes('withdraw');
}
function toggleBoxes(which) {
  document.getElementById('deposit-box').style.display = which=='deposit'?'block':'none';
  document.getElementById('withdraw-box').style.display = which=='withdraw'?'block':'none';
}

function makeDeposit(){
  const utr=document.getElementById('utr').value;
  if (!/^\d{12}$/.test(utr)) return alert('Enter 12-digit UTR');
  const u=getSaved(); u.bal+=100; // AUTO approve for now
  u.dep.push(utr);
  localStorage.setItem(STORAGE, JSON.stringify(u));
  document.getElementById('balance').innerText=u.bal;
  alert('Deposit success ₹100 added!');
  document.getElementById('deposit-box').style.display='none';
}

function makeWithdraw(){
  const amt=+document.getElementById('wamt').value;
  const u=getSaved();
  if (amt<minAmt||amt>u.bal) return alert('Invalid withdraw');
  u.bal-=amt;
  u.wdr.push(amt);
  localStorage.setItem(STORAGE, JSON.stringify(u));
  document.getElementById('balance').innerText=u.bal;
  alert('Withdraw request ₹'+amt+' placed!');
  document.getElementById('withdraw-box').style.display='none';
}

function startTimer(){
  let t=60;
  const ti = setInterval(()=>{
    t--; document.getElementById('time').innerText = t;
    if (t<=0) { clearInterval(ti); resolveRound(); }
  },1000);
}

function placeBet(type){
  currentBet = type;
  document.getElementById('bet-box').style.display='block';
}

function confirmBet(){
  const amt = +document.getElementById('bet-amt').value;
  const u=getSaved();
  if (amt<minAmt||amt>u.bal) return alert('Invalid bet');
  u.bal-=amt;
  localStorage.setItem(STORAGE, JSON.stringify(u));
  document.getElementById('balance').innerText=u.bal;
  document.getElementById('bet-box').style.display='none';
  document.getElementById('result').innerText='Bet placed: '+currentBet+' ₹'+amt;
}

function resolveRound(){
  const params = new URLSearchParams(location.search);
  const admin = params.get('admin')=='true';
  let res = admin ? prompt('Admin: Enter result (Red/Green/Big/Small)') : (Math.random()<0.5?'Red':'Green');
  document.getElementById('result').innerText += '\nResult: '+res;
  document.querySelectorAll('.bet-btn').forEach(b=>b.disabled=false);
  currentBet = null;
  startTimer();
}
</script>

</body>
                                            </html>
