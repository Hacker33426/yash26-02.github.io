<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Panel - YGWIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    .card {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    h2 { margin-top: 0; }
    button {
      margin: 5px;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button.approve { background-color: #4caf50; color: white; }
    button.reject { background-color: #f44336; color: white; }
    input, select {
      padding: 10px;
      width: 100%;
      margin: 8px 0;
      border-radius: 8px;
      border: none;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Set Result</h2>
    <p id="periodDisplay">Current Period: --</p>
    <select id="manualResult">
      <option value="">-- Select Result --</option>
      <option value="RED">RED</option>
      <option value="GREEN">GREEN</option>
    </select>
    <button onclick="setManualResult()">Set</button>
  </div>  <div class="card">
    <h2>Pending Deposits</h2>
    <div id="deposits"></div>
  </div>  <div class="card">
    <h2>Pending Withdrawals</h2>
    <div id="withdrawals"></div>
  </div><script>
function getPeriod(minuteOffset = 0) {
  const now = new Date();
  const mins = now.getUTCHours() * 60 + now.getUTCMinutes() + minuteOffset;
  return now.getUTCFullYear().toString() +
    String(now.getUTCMonth() + 1).padStart(2, '0') +
    String(now.getUTCDate()).padStart(2, '0') + "1000" + (10001 + mins);
}

let users = JSON.parse(localStorage.getItem("users") || "{}");
let deposits = JSON.parse(localStorage.getItem("deposits") || "[]");
let withdrawals = JSON.parse(localStorage.getItem("withdrawals") || "[]");
let manualResults = JSON.parse(localStorage.getItem("manualResults") || "{}");

document.getElementById("periodDisplay").innerText = "Current Period: " + getPeriod();

function setManualResult() {
  const result = document.getElementById("manualResult").value;
  const period = getPeriod();
  if (!result) return alert("Select a result");
  manualResults[period] = result;
  localStorage.setItem("manualResults", JSON.stringify(manualResults));
  alert("Result set for Period " + period + ": " + result);
}

function renderDeposits() {
  const container = document.getElementById("deposits");
  container.innerHTML = "";
  deposits.forEach((d, i) => {
    if (d.status === "pending") {
      container.innerHTML += `
        <div>
          <p><b>Phone:</b> ${d.phone} | ₹${d.amount} | UTR: ${d.utr}</p>
          <button class="approve" onclick="approveDeposit(${i})">Approve</button>
          <button class="reject" onclick="rejectDeposit(${i})">Reject</button>
        </div>
      `;
    }
  });
}

function approveDeposit(i) {
  const d = deposits[i];
  if (!users[d.phone]) return alert("User not found");
  users[d.phone].balance += d.amount;
  d.status = "approved";
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("deposits", JSON.stringify(deposits));
  renderDeposits();
}

function rejectDeposit(i) {
  deposits[i].status = "rejected";
  localStorage.setItem("deposits", JSON.stringify(deposits));
  renderDeposits();
}

function renderWithdrawals() {
  const container = document.getElementById("withdrawals");
  container.innerHTML = "";
  withdrawals.forEach((w, i) => {
    if (w.status === "pending") {
      container.innerHTML += `
        <div>
          <p><b>Phone:</b> ${w.phone} | ₹${w.amount} | UPI: ${w.upi}</p>
          <button class="approve" onclick="approveWithdraw(${i})">Approve</button>
          <button class="reject" onclick="rejectWithdraw(${i})">Reject</button>
        </div>
      `;
    }
  });
}

function approveWithdraw(i) {
  const w = withdrawals[i];
  if (!users[w.phone]) return alert("User not found");
  if (users[w.phone].balance < w.amount) return alert("Insufficient balance");
  users[w.phone].balance -= w.amount;
  w.status = "approved";
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("withdrawals", JSON.stringify(withdrawals));
  renderWithdrawals();
}

function rejectWithdraw(i) {
  withdrawals[i].status = "rejected";
  localStorage.setItem("withdrawals", JSON.stringify(withdrawals));
  renderWithdrawals();
}

renderDeposits();
renderWithdrawals();
</script></body>
  </html>
